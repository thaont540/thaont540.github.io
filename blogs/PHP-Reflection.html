<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:b="http://www.google.com/2005/gml/b" xmlns:data="http://www.google.com/2005/gml/data" xmlns:expr="http://www.google.com/2005/gml/expr">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="css/4205868711-css_bundle_v2.css" type="text/css" media="screen">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css" media="screen">
        <link rel="stylesheet" href="css/font.css" type="text/css" media="screen">
        <link rel="stylesheet" href="css/style.css" type="text/css" media="screen">
        <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0" name="viewport">
        <meta content="IE=Edge" http-equiv="X-UA-Compatible">
        <meta content="blogger" name="generator">
        <link rel="icon" type="image/x-icon" href="https://media.giphy.com/media/mRrXIdhpDXv1e/giphy.gif">
        <title>[ThaoNT] PHP Reflection</title>
        <style id="page-skin-1" type="text/css">
        </style>
    </head>
    <body class="">
        <div class="navbar no-items section" id="navbar" name="Navbar"></div>
        <div id="outer-wrapper">
            <div id="left-wrapper">
                <div id="toggle-wrapper">
                    <a href="#"><span class="fa fa-bars"></span></a>
                </div>
                <div class="left section" id="header" name="Header">
                    <div class="widget Header" data-version="1" id="Header1">
                        <div id="header-inner">
                            <div class="titlewrapper">
                                <h1 class="title">
                                    <a href="#">Nguyễn Thế Thạo</a>
                                </h1>
                            </div>
                            <div class="descriptionwrapper">
                                <p class="description"><span>Mỗi khi cảm thấy cuộc đời bế tắc, bạn nên đi ngủ, để thấy rằng, ngủ cũng *éo được T.T</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="left section" id="menu" name="Menu" style="display: none;">
                    <div class="widget PageList" data-version="1" id="PageList1">
                        <h2>Menu</h2>
                        <div class="widget-content">
                            <ul>
                                <li><a href="/">Trang chủ</a></li>
                                <li><a href="https://www.facebook.com/buonmotchutthoi/photos_albums?lst=100000222967559%3A100000222967559%3A1482594147">Ấn vào đây</a></li>
                                <li><a href="#">Đừng ấn vào đây</a></li>
                            </ul>
                            <div class="clear"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="main-wrapper">
                <div id="post-toolbar">
                    <a href="##" id="full-screen" title="Toggle Fullscreen"><span class="fa fa-expand"></span></a>
                    <div class="font-size">
                        <a href="##" id="smaller-font" title="Smaller Font Size"><span class="fa fa-minus"></span></a>
                        <a href="##" id="default-font" title="Default Font Size"><span class="fa fa-font"></span></a>
                        <a href="##" id="larger-font" title="Larger Font Size"><span class="fa fa-plus"></span></a>
                    </div>
                </div>
                <div class="main right section" id="main" name="Main">
                    <div class="widget Blog" data-version="1" id="Blog1">
                        <div class="blog-posts hfeed">
                            <div class="date-outer">
                                <div class="date-posts">
                                    <div class="post-outer">
                                        <div class="post hentry" itemprop="blogPost thing" itemscope="itemscope" itemtype="http://schema.org/BlogPosting">
                                            <h2 class="date-header">
                                                <span class="fa fa-calendar-o"></span>
                                                <span>
                                                    Thứ 7, ngày 24/12/2016
                                                </span>
                                            </h2>
                                            <h3 class="post-title entry-title" content="[ThaoNT] PHP Reflection" itemprop="headline">
                                                [ThaoNT] PHP Reflection
                                            </h3>
                                            <div class="post-header">
                                                <div class="post-header-line-1">
                                                    <span class="post-author vcard">
                                                        Được viết bởi
                                                        <span class="fn" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person">
                                                            <a class="g-profile" href="#" rel="author" title="author profile" data-gapiscan="true" data-onload="true" data-gapiattached="true">
                                                            <span itemprop="name">Thạo</span>
                                                            </a>
                                                        </span>
                                                    </span>
                                                    <span class="post-timestamp">
                                                        vào lúc
                                                        <a class="timestamp-link" href="#" rel="bookmark" title="permanent link"><abbr class="published" itemprop="datePublished" title="A hihi">24/12/2016</abbr></a>
                                                    </span>
                                                    <span class="post-labels">
                                                    nằm trong chuyên mục
                                                    <a href="#" rel="tag">Code vì food</a>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="post-body entry-content" id="post-body" itemprop="description articleBody">
                                            </div>
                                            <div id="test"></div>
                                            <div class="post-footer">
                                                <div class="author-profile" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person">
                                                    <img alt="Author" itemprop="image" src="https://scontent.fhan2-2.fna.fbcdn.net/v/t1.0-9/10406576_978682265482530_6327681735274055371_n.jpg?oh=a7ba523b19e7c92294c66ab01a4a7297&oe=58E0E5EF" width="50px">
                                                    <div>
                                                        <a class="g-profile" href="/" itemprop="url" rel="author" title="author profile" data-gapiscan="true" data-onload="true" data-gapiattached="true">
                                                        <span itemprop="name">Thạo</span>
                                                        </a>
                                                    </div>
                                                    <span itemprop="description">Heyo! I'm Thạo, Nice to meat you :#)</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
        </div>
        <script src="js/jquery.min.js" type="text/javascript"></script>

        <script type="text/javascript">
            //<![CDATA[
            $(window).load(function(){
              $("#preloader").fadeOut('slow');
            });
            //]]>
        </script>
        <script type="text/javascript">
            //<![CDATA[
            $(document).ready(function(){
            $('#menu').hide();
              $('#toggle-wrapper a').click(function(e){
            e.preventDefault();
            var icon = $(this).find('span');
                if(icon.hasClass('fa-bars')){
            icon.removeClass('fa-bars').addClass('fa-close');
            $('#menu').fadeIn();
                }else{
            icon.removeClass('fa-close').addClass('fa-bars');
            $('#menu').fadeOut();
            }
            });
            });
            //]]>
        </script>
        <script type="text/javascript">
            //<![CDATA[
                     $(function(){
               if($('.post-body iframe').length>0){
                 $('.post-body iframe').each(function(){
                   var youtube = new RegExp('youtube'), vimeo = new RegExp('vimeo'), dailymotion = new RegExp('dailymotion'), metacafe = new RegExp('metacafe');
                   if(youtube.test($(this).attr('src')) || vimeo.test($(this).attr('src')) || dailymotion.test($(this).attr('src')) || metacafe.test($(this).attr('src'))){
                     $(this).wrap('<div class="video-container">');
                   }
                   youtube = null;
                   vimeo = null;
             dailymotion = null;
             metacafe = null;
                 });
               }
            var normalFontSize = $('.post-body').css('font-size');
            if($('blockquote').length){	
            	var quoteNormalFontSize = $('blockquote').css('font-size').replace('px','');
               }
               $('#smaller-font').click(function(e){
            e.preventDefault();
            var currentSize = $('.post-body').css('font-size').replace('px','');
                 if(currentSize > 10){
             $('.post-body').css('font-size',(currentSize-2)+'px');
                   if($('blockquote').length){
            $('blockquote').css('font-size',(quoteNormalFontSize-2)+'px');
                   }
                 }
            });
               $('#larger-font').click(function(e){
            e.preventDefault();
            var currentSize = $('.post-body').css('font-size').replace('px','');
                 if(currentSize < 30){
             $('.post-body').css('font-size',(+currentSize+2)+'px');
                   if($('blockquote').length){
             	$('blockquote').css('font-size',(+quoteNormalFontSize+2)+'px');
                   }
                 }
            });
               $('#default-font').click(function(e){
            e.preventDefault();
            $('.post-body').css('font-size',normalFontSize);
                 if($('blockquote').length){
             $('blockquote').css('font-size',quoteNormalFontSize);
                 }
            });
               $('#full-screen').click(function(e){
            e.preventDefault();
            var leftWrap = $('#left-wrapper'), outerWrap = $('#outer-wrapper'), mainWrap = $('#main-wrapper'), footerWrap = $('#footer-wrapper'), toggle = $(this), leftWrapWidth = leftWrap.width();
                 if(leftWrap.css('left') != -leftWrapWidth+'px'){
                   leftWrap.animate({'left':-leftWrapWidth},400);
                   outerWrap.animate({'padding-left':0},400);
                   mainWrap.animate({'width':$(window).width()},400);
                   footerWrap.animate({'margin-left':0},400);
             toggle.find('span').addClass('fa-compress').removeClass('fa-expand');
                 }else{
                   leftWrap.animate({'left':leftWrapWidth},400);
                   outerWrap.animate({'padding-left':leftWrapWidth+'px'},400);
                   mainWrap.animate({'width':$(window).width()-leftWrapWidth},400);
                   footerWrap.animate({'margin-left':leftWrapWidth+'px'},400);
             toggle.find('span').addClass('fa-expand').removeClass('fa-compress');		  
            }
            });
            });
             	//]]>
            	  
        </script>
        <div id="footer-wrapper">
            <div class="foot no-items section" id="footer-1" name="Footer 1"></div>
            <table border="0" cellpadding="0" cellspacing="0" class="section-columns columns-2">
                <tbody>
                    <tr>
                        <td class="first columns-cell">
                            <div class="foot section" id="footer-2-1" name="Footer 2 - 1">
                                <div class="widget BlogArchive" data-version="1" id="BlogArchive1">
                                    <h2>Lưu trữ</h2>
                                    <div class="widget-content">
                                        <div id="ArchiveList">
                                            <div id="BlogArchive1_ArchiveList">
                                                <ul class="flat">
                                                    <li class="archivedate">
                                                        <a href="#/2016_01_01_archive.html">January</a> (1)
                                                    </li>
                                                    <li class="archivedate">
                                                        <a href="#/2015_12_01_archive.html">December</a> (6)
                                                    </li>
                                                    <li class="archivedate">
                                                        <a href="#/2015_11_01_archive.html">November</a> (3)
                                                    </li>
                                                    <li class="archivedate">
                                                        <a href="#/2015_10_01_archive.html">October</a> (1)
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="clear"></div>
                                    </div>
                                </div>
                                <div class="widget Label" data-version="1" id="Label1">
                                    <h2>Vài thứ hay hay</h2>
                                    <div class="widget-content list-label-widget-content">
                                        <ul>
                                            <li>
                                                <a dir="ltr" href="https://www.facebook.com/buonmotchutthoi/photos_albums?lst=100000222967559%3A100000222967559%3A1482595209">Awesome Pics</a>
                                                <span dir="ltr">(1)</span>
                                            </li>
                                            <li>
                                                <a dir="ltr" href="https://viblo.asia/users/show/thaont">Coding</a>
                                                <span dir="ltr">(2)</span>
                                            </li>
                                            <li>
                                                <a dir="ltr" href="http://mp3.zing.vn/playlist/SadEyes-haianh_friend/IW8C7OWU.html">Music</a>
                                                <span dir="ltr">(2)</span>
                                            </li>
                                            <li>
                                                <a dir="ltr" href="http://tonvinhvanhoadoc.vn/van-hoc-viet-nam/sang-tac/12107-truyen-ngan-thach-lam-ben-kia-song.html">Truyện ngắn Thạch Lam</a>
                                                <span dir="ltr">(3)</span>
                                            </li>
                                        </ul>
                                        <div class="clear"></div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="columns-cell">
                            <div class="foot section" id="footer-2-2" name="Footer 2 - 2">
                                <div class="widget PopularPosts" data-version="1" id="PopularPosts1">
                                    <h2>Chắc là nhiều người muốn xem?</h2>
                                    <div class="widget-content popular-posts">
                                        <ul>
                                            <li>
                                                <div class="item-content">
                                                    <div class="item-thumbnail">
                                                        <a href="#" target="_blank">
                                                        <img alt="" border="0" src="images/code-820275_1920(1).jpg">
                                                        </a>
                                                    </div>
                                                    <div class="item-title"><a href="https://viblo.asia/thaont/posts/OREGwBxzvlN" target="_blank">Extension Make silence cho Chatwork</a></div>
                                                    <div class="item-snippet">Chắc hẳn là chúng ta ít nhất tham gia 1 hoặc nhiều mạng xã hội hoặc diễn đàn nào đó. Và tất nhiên, tỷ lệ gặp những kẻ khó ưa càng cao đối với lượng thành viên càng lớn...</div>
                                                </div>
                                                <div style="clear: both;"></div>
                                            </li>
                                            <li>
                                                <div class="item-content">
                                                    <div class="item-title"><a href="https://viblo.asia/thaont/posts/ZabG9zYzvzY6" target="_blank">Làm quen với Shell Script</a></div>
                                                    <div class="item-snippet">Shell là một chương trình thông dịch lệnh của một hệ điều hành, cung cấp cho người dùng khả năng tương tác với hệ điều hành bằng cách gõ từng lệnh ở chế độ dòng lệnh, đồng thời trả lại kết quả thực hiện lệnh lại cho người sử dụng. Shell cung cấp tập hợp các lệnh đặc biệt mà từ đó có ...</div>
                                                </div>
                                                <div style="clear: both;"></div>
                                            </li>
                                            <li>
                                                <div class="item-content">
                                                    <iframe width="280" height="140" src="https://www.youtube.com/embed/sbfks7HdRoE" frameborder="0" allowfullscreen></iframe>
                                                </div>
                                                <div style="clear: both;"></div>
                                            </li>
                                        </ul>
                                        <div class="clear"></div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <!-- outside of the include in order to lock Attribution widget -->
            <div class="foot section" id="footer-3" name="Footer">
                <div class="widget Attribution" data-version="1" id="Attribution1">
                    <div class="widget-content" style="text-align: center;">
                        © Hí hí @. Powered by <a href="#" target="_blank">Thạo đại ca</a>.
                    </div>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="js/803954089-widgets.js"></script>
        <script type="text/javascript" src="js/plusone.js" gapi_processed="true"></script>
        <link type="text/css" rel="stylesheet" href="css/368954415-lightbox_bundle.css">
        <script type="text/javascript" src="js/2371771562-lbx__en_gb.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/4.4.0/markdown-it.min.js"></script>
        <script type="text/javascript">
            $(function () {
                var xmp = $('xmp#markdown');
                var mdText = xmp.html();
                var md = window.markdownit();
                $('#post-body').html(md.render(mdText));
            });
        </script>
    </body>
<xmp id="markdown" style="display: none;">
## Reflection là gì?

Ngắn gọn nhất thì có thể nói Reflection cung cấp khả năng phân tích cấu trúc bên trong một class bao gồm các: method, property, const, comment và thay đổi (modify) chúng.

## Nó dùng để làm gì?

Thật ra là mình cũng ít (không) khi nào dùng đến cái này lắm, nhưng qua tìm hiểu thì thấy nó khá là hữu ích, có thể thay đổi cách làm 1 số chuyện của mình.

Ví dụ đọc code của ai đó mà không biết cái biến này là gì, 1 object hay 1 số, 1 string thì có thể dùng hàm cơ bản của PHP là `get_class()` và `get_class_method()`.

Tiếp theo là chúng ta có thể sử dụng Reflection để tạo tài liệu bằng cách get comment của 1 class nào đó, rồi kiểm tra từng method, constructor và class đó để xác định những gì diễn ra đối với đầu vào và đầu ra.

## Các hàm Reflection thông dụng

Ví dụ ta dùng `get_class()` và `get_class_methods()`:

```PHP
var_dump(get_class($user));
//App\Models\User

var_dump(get_class_method($user));
//Method A
//Method B
//Method C
//Something else
```
`get_class()` trả về 1 string tên của class và `get_class_method()` trả về 1 mảng tên các method trong object đó.

Một hàm khác cũng hay dùng đấy là `method_exists()`:

```PHP
class User {

    protected function getUsername()
    {
        //....
    }

    public function __get($param)
    {
        $method = 'get' . ucfirst($param);

        if (method_exists($this, $method)) {
            return $this->{$method}();
        }
    }
}
```

Nhìn cũng đủ hiểu chức năng của cái hàm này là gì rồi đúng không?

## PHP Reflection Class

Để dễ hiểu hơn ta có 1 số class như sau:

```PHP
<?php

namespace App\Models\Facebook;

class UUID
{

}

abstract class Entity
{

}

interface Friendable
{

}

interface Likeable
{

}

interface Postable
{

}

class User extends Entity implements Friendable, Likeable, Postable
{
    public function __construct($name, UUID $uuid)
    {

    }

    public function like(Likebable $entity)
    {

    }

    public function friend(User $user)
    {

    }

    public function post(Post $post)
    {

    }
}
 
$reflection = new \ReflectionClass(new User('Sơn Tùng Ôm Ti Vi', new UUID(1234)));

```

### Get class name
Get full name

```PHP
echo $reflection->getName();
// App\Models\Facebook\User
```

Get name

```PHP
echo $reflection->getShortName();
// User
```

Get namespace
```PHP
echo $reflection->getNamespaceName();
// App\Models\Facebook
```

### Get parent class
Chúng ta có 1 instance ReflectionClass mới của class cha của User

```PHP
$parent = $reflection->getParentClass();
echo $parent->getName();
// App\Models\Facebook\Entity
```

### Get interfaces

```PHP
$interfaces = $reflection->getInterfaceNames();
 
echo "<pre>"; //Đây là cách hay dùng khi mà chưa biết đến Laravel :v
var_dump($interfaces);
/*
array(3) {
  [0]=>
  string(28) "App\Models\Facebook\Friendable"
  [1]=>
  string(26) "App\Models\Facebook\Likeable"
  [2]=>
  string(26) "App\Models\Facebook\Postable"
}
*/
```
Hoặc get 1 mảng các ReflectionClass instances của các interfaces

```PHP
$interfaces = $reflection->getInterfaces();
 
echo "<pre>";
var_dump($interfaces);
 
/*
array(3) {
  ["App\Models\Facebook\Friendable"]=>
  &object(ReflectionClass)#3 (1) {
    ["name"]=>
    string(28) "App\Models\Facebook\Friendable"
  }
  ["App\Models\Facebook\Likeable"]=>
  &object(ReflectionClass)#4 (1) {
    ["name"]=>
    string(26) "App\Models\Facebook\Likeable"
  }
  ["App\Models\Facebook\Postable"]=>
  &object(ReflectionClass)#5 (1) {
    ["name"]=>
    string(26) "App\Models\Facebook\Postable"
  }
}
*/
```

### Get class methods

```PHP
$methods = $reflection->getMethods();
var_dump($methods);
 
echo "<pre>";
var_dump($methods);
/*
array(3) {
  [0]=>
  &object(ReflectionMethod)#2 (2) {
    ["name"]=>
    string(4) "like"
    ["class"]=>
    string(22) "App\Models\Facebook\User"
  }
  [1]=>
  &object(ReflectionMethod)#3 (2) {
    ["name"]=>
    string(6) "friend"
    ["class"]=>
    string(22) "App\Models\Facebook\User"
  }
  [2]=>
  &object(ReflectionMethod)#4 (2) {
    ["name"]=>
    string(4) "post"
    ["class"]=>
    string(22) "App\Models\Facebook\User"
  }
}
*/
```

### Get constructor

```PHP
$constructor = $reflection->getConstructor();
 
echo "<pre>";
var_dump($constructor);
/*
object(ReflectionMethod)#2 (2) {
  ["name"]=>
  string(11) "__construct"
  ["class"]=>
  string(22) "App\Models\Facebook\User"
}
*/
```
Chúng ta có thể xem đầu vào của hàm khởi tạo này

```PHP
echo "<pre>";
var_dump($constructor->getParameters());
/*
array(2) {
  [0]=>
  &object(ReflectionParameter)#3 (1) {
    ["name"]=>
    string(4) "name"
  }
  [1]=>
  &object(ReflectionParameter)#4 (1) {
    ["name"]=>
    string(4) "uuid"
  }
}
*/
```

Cái `$constructor->getParameters()` này cũng là 1 mảng các instance `ReflectionParameter`, chúng ta lại có thể dùng được:

```PHP
$parameters = $constructor->getParameters();
 
echo "<pre>";
var_dump($parameters[1]->getClass());
/*
object(ReflectionClass)#5 (1) {
  ["name"]=>
  string(22) "App\Models\Facebook\UUID"
}
*/
```

### getDocComment

Như đã nói ở trên, chúng ta có thể get comment của 1 class. Ví dụ ta có 1 class như này:

```PHP
<?php

/** 
* A test class
*
* @param  foo bar
* @return baz
*/

class TestClass
{

}

$reflection = new ReflectionClass('TestClass');
var_dump($reflection->getDocComment())

```

và kết quả là như thế này

```
string(55) "/** 
* A test class
*
* @param  foo bar
* @return baz
*/"
```

## Làm gì với Refection

Giả sử ta có các class sau

```PHP
<?php

class Author 
{
    private $name;

    public function __construct($name)
    {
        $this->name = $name;
    }

    public function getName()
    {
        return $this->name;
    }
}

class Book 
{
    private $author;
    private $name;

    public function __construct($name, $author)
    {
        $this->name = $name;
        $this->author = $author;
    }

    public function getAuthor()
    {
        return $this->author;
    }
}
```

Khởi tạo 1 book thì có thể `$author` là 1 string hoặc là 1 instance của `Author`

```PHP
<?php
$book1 = new Book('Tắt đèn', 'Ngô Tất Tố');
var_dump($book1->getAuthor());
//Ngô Tất Tố

$author = new Author('Nam Cao');
$book2 = new Book('Làng Vũ Đại ngày ấy', $author);
var_dump($book2->getAuthor());
/*
&object(Author)#1 (1) {
    ["name"]=>
    string(4) "Nam Cao"
}
*/
```

Sửa class Book 

```PHP
    public function __construct($name, $author)
    {
        $this->name = $name;
        $this->author = $author;
        var_dump($author->getName());
    }
```

Nhìn qua ta thấy ngay là chạy `$book1` sẽ bị lỗi và `$book2` cho ta kết quả là "Nam Cao". Vào thời điểm runtime $book2, PHP sẽ kiểm tra $author truyền vào cho constructor và tự hiểu $author là 1 instance của class Author và có 1 method là getName(). Đó chính là Refection mà PHP đã dùng để biết được kiểu của biến truyền vào.

Mấy ngôn ngữ mà làm được việc trên gọi là `dynamically-typed language`, là ngôn ngữ có thể tự hiểu được object tại thời điểm runtime, không cần tại compile time. PHP, Ruby, Python là `dynamically-typed language`. Ngược lại C hay Java là `statically-typed language`.

## Kết luận

- Cảm ơn nhà tài trợ [Google search](https://www.google.com.vn/?gfe_rd=cr&ei=rCRhWOHeMpSH1ASSgIHADA#q=what+is+php+reflection) đã đồng hành cùng bài viết này.
- Link tới [Viblo](https://viblo.asia/thaont/posts/mrDGMMOMGzL)

</xmp>

</html>